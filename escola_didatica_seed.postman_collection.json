{
  "info": {
    "name": "Escola Didatica - Seed",
    "_postman_id": "00000000-0000-0000-0000-000000000001",
    "description": "Seed de professores, disciplinas, estudantes e matriculas na API FastAPI.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Seed - Popular Banco",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/health",
          "host": ["{{baseUrl}}"],
          "path": ["health"]
        },
        "description": "Esta request usa um script pre-request para cadastrar todos os dados."
      },
      "response": [],
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "/*",
              "  Script de seed: cria professores, disciplinas, estudantes e matriculas.",
              "  Necessário ter variavel de ambiente/collection baseUrl, ex: http://127.0.0.1:8000",
              "*/",
              "",
              "const baseUrl = pm.collectionVariables.get(\"baseUrl\") || pm.environment.get(\"baseUrl\");",
              "if (!baseUrl) {",
              "  console.log(\"Defina a variável baseUrl (ex: http://127.0.0.1:8000)\");",
              "}",
              "",
              "// Dados de seed",
              "const professores = [",
              "  { nome: \"Ana Souza\" },",
              "  { nome: \"Bruno Lima\" },",
              "  { nome: \"Carla Mendes\" },",
              "  { nome: \"Diego Ferreira\" },",
              "  { nome: \"Elisa Rocha\" }",
              "];",
              "",
              "const disciplinas = [",
              "  { nome: \"Matemática Básica\", descricao: \"Operações fundamentais, frações e porcentagens.\" },",
              "  { nome: \"Português\", descricao: \"Leitura, interpretação de texto e gramática.\" },",
              "  { nome: \"História do Brasil\", descricao: \"Período colonial, império e república.\" },",
              "  { nome: \"Geografia Geral\", descricao: \"Continentes, clima e relevo.\" },",
              "  { nome: \"Ciências\", descricao: \"Corpo humano, ecossistemas e energia.\" },",
              "  { nome: \"Física I\", descricao: \"Movimento, força e leis de Newton.\" },",
              "  { nome: \"Programação em Python\", descricao: \"Lógica de programação e introdução à linguagem Python.\" },",
              "  { nome: \"Banco de Dados\", descricao: \"Conceitos de tabelas, chaves e SQL básico.\" }",
              "];",
              "",
              "const estudantes = [",
              "  {",
              "    nome: \"João Silva\",",
              "    email: \"joao.silva@didatica.com\",",
              "    perfil: { idade: 16, endereco: \"Rua das Flores, 123\" }",
              "  },",
              "  {",
              "    nome: \"Maria Oliveira\",",
              "    email: \"maria.oliveira@didatica.com\",",
              "    perfil: { idade: 17, endereco: \"Avenida Central, 456\" }",
              "  },",
              "  {",
              "    nome: \"Pedro Santos\",",
              "    email: \"pedro.santos@didatica.com\",",
              "    perfil: { idade: 15, endereco: \"Rua do Lago, 789\" }",
              "  },",
              "  {",
              "    nome: \"Ana Paula\",",
              "    email: \"ana.paula@didatica.com\",",
              "    perfil: { idade: 18, endereco: \"Rua Monteiro Lobato, 101\" }",
              "  },",
              "  {",
              "    nome: \"Lucas Martins\",",
              "    email: \"lucas.martins@didatica.com\",",
              "    perfil: { idade: 16, endereco: \"Rua das Acácias, 202\" }",
              "  }",
              "];",
              "",
              "// Arrays para armazenar IDs retornados",
              "let profIds = [];",
              "let discIds = [];",
              "let estIds = [];",
              "",
              "function post(url, body) {",
              "  return new Promise((resolve, reject) => {",
              "    pm.sendRequest({",
              "      url: url,",
              "      method: 'POST',",
              "      header: { 'Content-Type': 'application/json' },",
              "      body: { mode: 'raw', raw: JSON.stringify(body) }",
              "    }, (err, res) => {",
              "      if (err) {",
              "        console.log('ERRO em', url, err);",
              "        return reject(err);",
              "      }",
              "      if (!res) {",
              "        return reject(new Error('Sem resposta em ' + url));",
              "      }",
              "      try {",
              "        const json = res.json();",
              "        resolve(json);",
              "      } catch (e) {",
              "        console.log('Erro ao parsear JSON de', url, res.text());",
              "        reject(e);",
              "      }",
              "    });",
              "  });",
              "}",
              "",
              "async function seed() {",
              "  console.log('--- Iniciando seed Escola Didatica ---');",
              "",
              "  // 1) Professores",
              "  console.log('Criando professores...');",
              "  for (const p of professores) {",
              "    const created = await post(baseUrl + '/professores/', p);",
              "    profIds.push(created.id);",
              "  }",
              "  console.log('Professores criados:', profIds);",
              "",
              "  // 2) Disciplinas (associar professor por índice)",
              "  console.log('Criando disciplinas...');",
              "  for (let i = 0; i < disciplinas.length; i++) {",
              "    const d = disciplinas[i];",
              "    const profId = profIds[i % profIds.length];",
              "    // Seu backend DisciplinaCreate não tem professor_id,",
              "    // a relação professor-estudante está no Estudante.",
              "    // Então aqui criamos só a disciplina mesmo.",
              "    const created = await post(baseUrl + '/disciplinas/', {",
              "      nome: d.nome,",
              "      descricao: d.descricao",
              "    });",
              "    discIds.push(created.id);",
              "  }",
              "  console.log('Disciplinas criadas:', discIds);",
              "",
              "  // 3) Estudantes (sem professor_id no schema de entrada atual)",
              "  console.log('Criando estudantes...');",
              "  for (const e of estudantes) {",
              "    const created = await post(baseUrl + '/estudantes/', e);",
              "    estIds.push(created.id);",
              "  }",
              "  console.log('Estudantes criados:', estIds);",
              "",
              "  // 4) Matrículas (estudante_id, disciplina_id)",
              "  console.log('Criando matrículas...');",
              "",
              "  // Map simbólico: assumindo a ordem dos arrays acima",
              "  // João Silva (estIds[0]) -> Matemática Básica, Português, Programação em Python",
              "  const matriculas = [];",
              "  if (estIds.length >= 1 && discIds.length >= 8) {",
              "    matriculas.push({ estudante_id: estIds[0], disciplina_id: discIds[0] });",
              "    matriculas.push({ estudante_id: estIds[0], disciplina_id: discIds[1] });",
              "    matriculas.push({ estudante_id: estIds[0], disciplina_id: discIds[6] });",
              "  }",
              "",
              "  // Maria Oliveira (estIds[1]) -> Matemática Básica, História do Brasil, Banco de Dados",
              "  if (estIds.length >= 2 && discIds.length >= 8) {",
              "    matriculas.push({ estudante_id: estIds[1], disciplina_id: discIds[0] });",
              "    matriculas.push({ estudante_id: estIds[1], disciplina_id: discIds[2] });",
              "    matriculas.push({ estudante_id: estIds[1], disciplina_id: discIds[7] });",
              "  }",
              "",
              "  // Pedro Santos (estIds[2]) -> Ciências, Geografia Geral",
              "  if (estIds.length >= 3 && discIds.length >= 5) {",
              "    matriculas.push({ estudante_id: estIds[2], disciplina_id: discIds[4] });",
              "    matriculas.push({ estudante_id: estIds[2], disciplina_id: discIds[3] });",
              "  }",
              "",
              "  // Ana Paula (estIds[3]) -> Física I, Programação em Python, Banco de Dados",
              "  if (estIds.length >= 4 && discIds.length >= 8) {",
              "    matriculas.push({ estudante_id: estIds[3], disciplina_id: discIds[5] });",
              "    matriculas.push({ estudante_id: estIds[3], disciplina_id: discIds[6] });",
              "    matriculas.push({ estudante_id: estIds[3], disciplina_id: discIds[7] });",
              "  }",
              "",
              "  // Lucas Martins (estIds[4]) -> Matemática Básica, Ciências",
              "  if (estIds.length >= 5 && discIds.length >= 5) {",
              "    matriculas.push({ estudante_id: estIds[4], disciplina_id: discIds[0] });",
              "    matriculas.push({ estudante_id: estIds[4], disciplina_id: discIds[4] });",
              "  }",
              "",
              "  for (const m of matriculas) {",
              "    await post(baseUrl + '/matriculas/', m);",
              "  }",
              "  console.log('Matrículas criadas:', matriculas);",
              "",
              "  console.log('--- Seed concluído ---');",
              "}",
              "",
              "if (baseUrl) {",
              "  // roda em background antes da request principal",
              "  seed().catch(e => console.log('Erro no seed:', e));",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://127.0.0.1:8000"
    }
  ]
}
